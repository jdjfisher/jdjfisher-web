---
import ProjectPageLayout from '../../layouts/ProjectPageLayout.astro';
import { z } from 'zod';
import Placeholder from '../../components/Placeholder.astro';
import { getCollection } from 'astro:content';
import { getEntry } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');

  return projects.map((project) => ({
    params: { slug: project.id },
  }));
}

const slug = z.string().parse(Astro.params.slug);

const project = await getEntry('projects', slug)!;

let ProjectComponent: any = null;

try {
  const module = await import(`../../content/projects/${slug}/page.astro`);
  ProjectComponent = module.default;
} catch (error) {
  process.stdout.write(` no custom component for ${slug}`);
}
---

<ProjectPageLayout project={project.data}>
  {ProjectComponent ? <ProjectComponent /> : <Placeholder />}
</ProjectPageLayout>
